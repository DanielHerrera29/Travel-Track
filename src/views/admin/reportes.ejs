<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes del Sistema</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: #2c3e50;
            color: white;
            padding: 20px 0;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #34495e;
            margin-bottom: 20px;
        }

        .sidebar-header h2 {
            font-size: 20px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin: 5px 0;
        }

        .sidebar-menu a {
            display: block;
            color: #ecf0f1;
            text-decoration: none;
            padding: 12px 20px;
            transition: background 0.3s;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: #34495e;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
        }

        .top-bar {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .content-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .report-card {
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            padding: 25px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .report-card:hover {
            border-color: #3498db;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }

        .report-icon {
            width: 60px;
            height: 60px;
            background: #3498db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .report-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .report-description {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 15px;
        }

        .filters-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }

        .filter-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .summary-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        table th {
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: 600;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .loader {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        #reporteResultado {
            display: none;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Sistema de Transporte</h2>
            <p style="font-size: 12px; color: #95a5a6;">Panel Admin</p>
        </div>
        <ul class="sidebar-menu">
            <li><a href="/admin/dashboard">Dashboard</a></li>
            <li><a href="/admin/usuarios">Gesti贸n de Usuarios</a></li>
            <li><a href="/admin/rutas">Gesti贸n de Rutas</a></li>
            <li><a href="/admin/viajes">Gesti贸n de Viajes</a></li>
            <li><a href="/admin/costos">Costos Operativos</a></li>
            <li><a href="/admin/reportes" class="active">Reportes</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <h1>Reportes del Sistema</h1>
            <button class="btn btn-primary" onclick="logout()">Cerrar Sesi贸n</button>
        </div>

        <div class="content-section">
            <h2>Selecciona el tipo de reporte</h2>
            
            <div class="report-grid">
                <div class="report-card" onclick="seleccionarReporte('operacion')">
                    <div class="report-icon" style="background: #3498db;"></div>
                    <div class="report-title">Reporte de Operaci贸n</div>
                    <div class="report-description">
                        Analiza viajes realizados, costos e incidencias en un per铆odo espec铆fico
                    </div>
                </div>

                <div class="report-card" onclick="seleccionarReporte('costos')">
                    <div class="report-icon" style="background: #e74c3c;"></div>
                    <div class="report-title">Reporte de Costos</div>
                    <div class="report-description">
                        Detalle de gastos operativos y an谩lisis financiero por per铆odo
                    </div>
                </div>

                <div class="report-card" onclick="seleccionarReporte('conductores')">
                    <div class="report-icon" style="background: #2ecc71;"></div>
                    <div class="report-title">Reporte de Conductores</div>
                    <div class="report-description">
                        Desempe帽o y estad铆sticas de conductores activos
                    </div>
                </div>

                <div class="report-card" onclick="seleccionarReporte('rutas')">
                    <div class="report-icon" style="background: #f39c12;"></div>
                    <div class="report-title">Rentabilidad por Rutas</div>
                    <div class="report-description">
                        An谩lisis de ingresos y costos por cada ruta
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci贸n de Filtros -->
        <div id="filtrosReporte" class="content-section" style="display: none;">
            <h3 id="tituloReporte">Reporte Seleccionado</h3>
            
            <div class="filters-section">
                <div class="filters">
                    <div class="filter-group">
                        <label>Fecha Inicio:</label>
                        <input type="date" id="fechaInicio" required>
                    </div>
                    <div class="filter-group">
                        <label>Fecha Fin:</label>
                        <input type="date" id="fechaFin" required>
                    </div>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="generarReporte()">
                        Generar Reporte
                    </button>
                    <button class="btn" onclick="cancelarReporte()">
                        Cancelar
                    </button>
                </div>
            </div>

            <div id="loader" class="loader" style="display: none;">
                Generando reporte...
            </div>

            <div id="reporteResultado"></div>
        </div>
    </div>

    <script>
        let tipoReporteActual = null;

        function seleccionarReporte(tipo) {
            tipoReporteActual = tipo;
            
            const titulos = {
                'operacion': 'Reporte de Operaci贸n',
                'costos': 'Reporte de Costos',
                'conductores': 'Reporte de Conductores',
                'rutas': 'Rentabilidad por Rutas'
            };

            document.getElementById('tituloReporte').textContent = titulos[tipo];
            document.getElementById('filtrosReporte').style.display = 'block';
            document.getElementById('reporteResultado').style.display = 'none';
            document.getElementById('reporteResultado').innerHTML = '';

            // Scroll a los filtros
            document.getElementById('filtrosReporte').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelarReporte() {
            document.getElementById('filtrosReporte').style.display = 'none';
            tipoReporteActual = null;
        }

        async function generarReporte() {
            const fechaInicio = document.getElementById('fechaInicio').value;
            const fechaFin = document.getElementById('fechaFin').value;

            if (!fechaInicio || !fechaFin) {
                alert('Por favor selecciona ambas fechas');
                return;
            }

            if (fechaInicio > fechaFin) {
                alert('La fecha de inicio no puede ser mayor a la fecha fin');
                return;
            }

            document.getElementById('loader').style.display = 'block';
            document.getElementById('reporteResultado').innerHTML = '';

            try {
                let data;
                switch(tipoReporteActual) {
                    case 'operacion':
                        data = await generarReporteOperacion(fechaInicio, fechaFin);
                        break;
                    case 'costos':
                        data = await generarReporteCostos(fechaInicio, fechaFin);
                        break;
                    case 'conductores':
                        data = await generarReporteConductores(fechaInicio, fechaFin);
                        break;
                    case 'rutas':
                        data = await generarReporteRutas(fechaInicio, fechaFin);
                        break;
                }
            } catch (error) {
                alert('Error al generar reporte: ' + error.message);
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        async function generarReporteOperacion(fechaInicio, fechaFin) {
            const response = await fetch(
                `/api/admin/reportes/operacion?fechaInicio=${fechaInicio}&fechaFin=${fechaFin}`,
                {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                }
            );

            const result = await response.json();

            if (result.success) {
                const { resumen, detalles } = result.data;
                
                const html = `
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">Total Viajes</div>
                            <div class="summary-value">${resumen.totalViajes}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Viajes Completados</div>
                            <div class="summary-value">${resumen.viajesCompletados}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Costos Totales</div>
                            <div class="summary-value">$${resumen.totalCostos.toLocaleString('es-CO')}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Incidencias</div>
                            <div class="summary-value">${resumen.totalIncidencias}</div>
                        </div>
                    </div>

                    <h4 style="margin-top: 30px; margin-bottom: 15px;">Detalle de Viajes</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Ruta</th>
                                <th>Conductor</th>
                                <th>Estado</th>
                                <th>Pasajeros</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${detalles.viajes.map(v => `
                                <tr>
                                    <td>${new Date(v.fecha).toLocaleDateString('es-CO')}</td>
                                    <td>${v.ruta_nombre || 'N/A'}</td>
                                    <td>${v.conductor_nombre || 'N/A'}</td>
                                    <td>${v.estado}</td>
                                    <td>${v.pasajeros_totales || 0}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('reporteResultado').innerHTML = html;
                document.getElementById('reporteResultado').style.display = 'block';
            }
        }

        async function generarReporteCostos(fechaInicio, fechaFin) {
            const response = await fetch(
                `/api/admin/reportes/costos?fechaInicio=${fechaInicio}&fechaFin=${fechaFin}`,
                {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                }
            );

            const result = await response.json();

            if (result.success) {
                const { resumen, costos } = result.data;
                
                const total = costos.reduce((sum, c) => sum + parseFloat(c.monto), 0);
                
                const html = `
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">Total Gastos</div>
                            <div class="summary-value">$${total.toLocaleString('es-CO')}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Cantidad Registros</div>
                            <div class="summary-value">${costos.length}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Promedio por Gasto</div>
                            <div class="summary-value">$${(total / costos.length || 0).toLocaleString('es-CO', {maximumFractionDigits: 0})}</div>
                        </div>
                    </div>

                    <h4 style="margin-top: 30px; margin-bottom: 15px;">Detalle de Costos</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Viaje / Ruta</th>
                                <th>Descripci贸n</th>
                                <th>Monto</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${costos.map(c => `
                                <tr>
                                    <td>${new Date(c.fecha).toLocaleDateString('es-CO')}</td>
                                    <td>${c.ruta_nombre || 'N/A'}</td>
                                    <td>${c.descripcion}</td>
                                    <td style="font-weight: 600; color: #e74c3c;">
                                        $${parseFloat(c.monto).toLocaleString('es-CO')}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('reporteResultado').innerHTML = html;
                document.getElementById('reporteResultado').style.display = 'block';
            }
        }

        async function generarReporteConductores(fechaInicio, fechaFin) {
            // Simulaci贸n - puedes implementar el endpoint espec铆fico
            alert('Reporte de conductores en desarrollo');
        }

        async function generarReporteRutas(fechaInicio, fechaFin) {
            // Simulaci贸n - puedes implementar el endpoint espec铆fico
            alert('Reporte de rutas en desarrollo');
        }

        function logout() {
            localStorage.removeItem('token');
            location.href = '/login';
        }
    </script>
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes del Sistema</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: #2c3e50;
            color: white;
            padding: 20px 0;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #34495e;
            margin-bottom: 20px;
        }

        .sidebar-header h2 {
            font-size: 20px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin: 5px 0;
        }

        .sidebar-menu a {
            display: block;
            color: #ecf0f1;
            text-decoration: none;
            padding: 12px 20px;
            transition: background 0.3s;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            background: #34495e;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
        }

        .top-bar {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
        }

        .content-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .report-card {
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            padding: 25px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .report-card:hover {
            border-color: #3498db;
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }

        .report-icon {
            width: 60px;
            height: 60px;
            background: #3498db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .report-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .report-description {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 15px;
        }

        .filters-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
        }

        .filter-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .summary-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .summary-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .summary-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        table th {
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: 600;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .loader {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        #reporteResultado {
            display: none;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Sistema de Transporte</h2>
            <p style="font-size: 12px; color: #95a5a6;">Panel Admin</p>
        </div>
        <ul class="sidebar-menu">
            <li><a href="/admin/dashboard">Dashboard</a></li>
            <li><a href="/admin/usuarios">Gesti贸n de Usuarios</a></li>
            <li><a href="/admin/rutas">Gesti贸n de Rutas</a></li>
            <li><a href="/admin/viajes">Gesti贸n de Viajes</a></li>
            <li><a href="/admin/costos">Costos Operativos</a></li>
            <li><a href="/admin/reportes" class="active">Reportes</a></li>
        </ul>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <h1>Reportes del Sistema</h1>
            <button class="btn btn-primary" onclick="logout()">Cerrar Sesi贸n</button>
        </div>

        <div class="content-section">
            <h2>Selecciona el tipo de reporte</h2>
            
            <div class="report-grid">
                <div class="report-card" onclick="seleccionarReporte('operacion')">
                    <div class="report-icon" style="background: #3498db;"></div>
                    <div class="report-title">Reporte de Operaci贸n</div>
                    <div class="report-description">
                        Analiza viajes realizados, costos e incidencias en un per铆odo espec铆fico
                    </div>
                </div>

                <div class="report-card" onclick="seleccionarReporte('costos')">
                    <div class="report-icon" style="background: #e74c3c;"></div>
                    <div class="report-title">Reporte de Costos</div>
                    <div class="report-description">
                        Detalle de gastos operativos y an谩lisis financiero por per铆odo
                    </div>
                </div>

                <div class="report-card" onclick="seleccionarReporte('conductores')">
                    <div class="report-icon" style="background: #2ecc71;"></div>
                    <div class="report-title">Reporte de Conductores</div>
                    <div class="report-description">
                        Desempe帽o y estad铆sticas de conductores activos
                    </div>
                </div>

                <div class="report-card" onclick="seleccionarReporte('rutas')">
                    <div class="report-icon" style="background: #f39c12;"></div>
                    <div class="report-title">Rentabilidad por Rutas</div>
                    <div class="report-description">
                        An谩lisis de ingresos y costos por cada ruta
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci贸n de Filtros -->
        <div id="filtrosReporte" class="content-section" style="display: none;">
            <h3 id="tituloReporte">Reporte Seleccionado</h3>
            
            <div class="filters-section">
                <div class="filters">
                    <div class="filter-group">
                        <label>Fecha Inicio:</label>
                        <input type="date" id="fechaInicio" required>
                    </div>
                    <div class="filter-group">
                        <label>Fecha Fin:</label>
                        <input type="date" id="fechaFin" required>
                    </div>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="generarReporte()">
                        Generar Reporte
                    </button>
                    <button class="btn" onclick="cancelarReporte()">
                        Cancelar
                    </button>
                </div>
            </div>

            <div id="loader" class="loader" style="display: none;">
                Generando reporte...
            </div>

            <div id="reporteResultado"></div>
        </div>
    </div>

    <script>
        let tipoReporteActual = null;

        function seleccionarReporte(tipo) {
            tipoReporteActual = tipo;
            
            const titulos = {
                'operacion': 'Reporte de Operaci贸n',
                'costos': 'Reporte de Costos',
                'conductores': 'Reporte de Conductores',
                'rutas': 'Rentabilidad por Rutas'
            };

            document.getElementById('tituloReporte').textContent = titulos[tipo];
            document.getElementById('filtrosReporte').style.display = 'block';
            document.getElementById('reporteResultado').style.display = 'none';
            document.getElementById('reporteResultado').innerHTML = '';

            // Scroll a los filtros
            document.getElementById('filtrosReporte').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelarReporte() {
            document.getElementById('filtrosReporte').style.display = 'none';
            tipoReporteActual = null;
        }

        async function generarReporte() {
            const fechaInicio = document.getElementById('fechaInicio').value;
            const fechaFin = document.getElementById('fechaFin').value;

            if (!fechaInicio || !fechaFin) {
                alert('Por favor selecciona ambas fechas');
                return;
            }

            if (fechaInicio > fechaFin) {
                alert('La fecha de inicio no puede ser mayor a la fecha fin');
                return;
            }

            document.getElementById('loader').style.display = 'block';
            document.getElementById('reporteResultado').innerHTML = '';

            try {
                let data;
                switch(tipoReporteActual) {
                    case 'operacion':
                        data = await generarReporteOperacion(fechaInicio, fechaFin);
                        break;
                    case 'costos':
                        data = await generarReporteCostos(fechaInicio, fechaFin);
                        break;
                    case 'conductores':
                        data = await generarReporteConductores(fechaInicio, fechaFin);
                        break;
                    case 'rutas':
                        data = await generarReporteRutas(fechaInicio, fechaFin);
                        break;
                }
            } catch (error) {
                alert('Error al generar reporte: ' + error.message);
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        async function generarReporteOperacion(fechaInicio, fechaFin) {
            const response = await fetch(
                `/api/admin/reportes/operacion?fechaInicio=${fechaInicio}&fechaFin=${fechaFin}`,
                {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                }
            );

            const result = await response.json();

            if (result.success) {
                const { resumen, detalles } = result.data;
                
                const html = `
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">Total Viajes</div>
                            <div class="summary-value">${resumen.totalViajes}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Viajes Completados</div>
                            <div class="summary-value">${resumen.viajesCompletados}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Costos Totales</div>
                            <div class="summary-value">$${resumen.totalCostos.toLocaleString('es-CO')}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Incidencias</div>
                            <div class="summary-value">${resumen.totalIncidencias}</div>
                        </div>
                    </div>

                    <h4 style="margin-top: 30px; margin-bottom: 15px;">Detalle de Viajes</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Ruta</th>
                                <th>Conductor</th>
                                <th>Estado</th>
                                <th>Pasajeros</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${detalles.viajes.map(v => `
                                <tr>
                                    <td>${new Date(v.fecha).toLocaleDateString('es-CO')}</td>
                                    <td>${v.ruta_nombre || 'N/A'}</td>
                                    <td>${v.conductor_nombre || 'N/A'}</td>
                                    <td>${v.estado}</td>
                                    <td>${v.pasajeros_totales || 0}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('reporteResultado').innerHTML = html;
                document.getElementById('reporteResultado').style.display = 'block';
            }
        }

        async function generarReporteCostos(fechaInicio, fechaFin) {
            const response = await fetch(
                `/api/admin/reportes/costos?fechaInicio=${fechaInicio}&fechaFin=${fechaFin}`,
                {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                }
            );

            const result = await response.json();

            if (result.success) {
                const { resumen, costos } = result.data;
                
                const total = costos.reduce((sum, c) => sum + parseFloat(c.monto), 0);
                
                const html = `
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">Total Gastos</div>
                            <div class="summary-value">$${total.toLocaleString('es-CO')}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Cantidad Registros</div>
                            <div class="summary-value">${costos.length}</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Promedio por Gasto</div>
                            <div class="summary-value">$${(total / costos.length || 0).toLocaleString('es-CO', {maximumFractionDigits: 0})}</div>
                        </div>
                    </div>

                    <h4 style="margin-top: 30px; margin-bottom: 15px;">Detalle de Costos</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Viaje / Ruta</th>
                                <th>Descripci贸n</th>
                                <th>Monto</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${costos.map(c => `
                                <tr>
                                    <td>${new Date(c.fecha).toLocaleDateString('es-CO')}</td>
                                    <td>${c.ruta_nombre || 'N/A'}</td>
                                    <td>${c.descripcion}</td>
                                    <td style="font-weight: 600; color: #e74c3c;">
                                        $${parseFloat(c.monto).toLocaleString('es-CO')}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('reporteResultado').innerHTML = html;
                document.getElementById('reporteResultado').style.display = 'block';
            }
        }

        async function generarReporteConductores(fechaInicio, fechaFin) {
            // Simulaci贸n - puedes implementar el endpoint espec铆fico
            alert('Reporte de conductores en desarrollo');
        }

        async function generarReporteRutas(fechaInicio, fechaFin) {
            // Simulaci贸n - puedes implementar el endpoint espec铆fico
            alert('Reporte de rutas en desarrollo');
        }

        function logout() {
            localStorage.removeItem('token');
            location.href = '/login';
        }
    </script>
</body>
</html>