<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Rutas</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet para mapas -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

</head>
<body class="bg-gray-100">

<div class="max-w-6xl mx-auto mt-10">
    <h1 class="text-3xl font-bold mb-6">Gestión de Rutas</h1>

    <!-- Selección de puntos -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <div class="bg-white p-5 rounded shadow">

            <h2 class="text-xl font-bold mb-4">Buscar Ruta Real</h2>

            <label>Origen (Lat, Lon)</label>
            <input id="origenLat" placeholder="4.7613" class="input"/>
            <input id="origenLon" placeholder="-74.0466" class="input"/>

            <label class="mt-3">Destino (Lat, Lon)</label>
            <input id="destinoLat" placeholder="4.6673" class="input"/>
            <input id="destinoLon" placeholder="-74.0547" class="input"/>

            <button onclick="buscarRuta()"
                    class="mt-4 px-6 py-3 bg-blue-600 text-white rounded">
                Obtener Ruta Real
            </button>

        </div>

        <!-- Mapa -->
        <div id="map" class="w-full h-80 rounded shadow"></div>

    </div>

    <!-- Rutas ya guardadas -->
    <h2 class="text-2xl mt-10 mb-4">Rutas Registradas</h2>

    <div class="bg-white p-4 rounded shadow h-64 overflow-y-scroll">
        <% rutas.forEach(r => { %>
            <div class="p-3 border-b">
                <strong><%= r.nombre_ruta %></strong><br>
                <span class="text-gray-600">
                    <%= r.ciudad_origen %> -> <%= r.ciudad_destino %>  
                    (<%= r.distancia_km %> km)
                </span>
            </div>
        <% }) %>
    </div>

</div>

<script>
    const map = L.map('map').setView([4.65, -74.1], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    let rutaLayer;

    async function buscarRuta() {
        const data = await fetch(`/rutas/api/osrm?origenLon=${origenLon.value}&origenLat=${origenLat.value}&destinoLon=${destinoLon.value}&destinoLat=${destinoLat.value}`)
            .then(r => r.json());

        const geometry = data.routes[0].geometry;

        if (rutaLayer) map.removeLayer(rutaLayer);

        rutaLayer = L.geoJSON(geometry).addTo(map);

        map.fitBounds(rutaLayer.getBounds());
    }
</script>

</body>
</html>
